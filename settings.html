<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Comforting Otter – Settings</title>
  <link rel="stylesheet" href="app-style.css">
  <style>
    .settingsStack{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .generatorPanel{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .generatorForm{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .input{
      background:#050c0a;
      border:1px solid var(--borderSoft);
      color:var(--text);
      border-radius:999px;
      padding:6px 12px;
      font-size:13px;
      min-width:220px;
    }
    .generatorList{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .generatorItem{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border-radius:999px;
      padding:6px 10px;
      border:1px solid var(--borderSoft);
      background:rgba(15,23,42,0.6);
    }
    .generatorName{
      font-size:13px;
    }
    .emptyState{
      color:var(--muted);
      font-size:13px;
    }
  </style>
</head>
<body>
  <header class="pageHeader">
    <div>
      <h1>Settings</h1>
      <div class="subhead">
        Quick access to maintenance and migration utilities.
      </div>
    </div>
    <div class="navMenuShell">
      <details class="navDropdown">
        <summary class="navTrigger">Menu ▾</summary>
        <div class="navMenuList">
          <a class="navItem" href="index.html?tab=Library">Library</a>
          <a class="navItem" href="index.html?tab=Matchups">Matchups</a>
          <a class="navItem" href="index.html?tab=Stats">Stats</a>
          <a class="navItem" href="index.html?tab=Collections">Collections</a>
          <div class="navSpacer"></div>
          <a class="navItem" href="tourney.html">Tournament</a>
          <a class="navItem active" href="settings.html">Settings</a>
        </div>
      </details>
    </div>
  </header>

  <main class="settingsStack">
    <section class="card" style="display:flex;flex-direction:column;gap:12px;">
      <a class="btn" href="sizes.html">Image Sizes</a>
      <a class="btn" href="duplicates.html">Title Twins</a>
      <a class="btn" href="normalize-urls.html">Normalize URLs</a>
      <a class="btn" href="unmigrated-report.html">Unmigrated Report</a>
      <a class="btn" href="compare-metadata.html">Compare Library Exports</a>
      <a class="btn" href="generator-settings.html">Generator Catalog</a>
      <a class="btn" href="migrate.html">Firebase Migrations</a>
      <a class="btn" href="thumb-maintenance.html">Thumb Maintenance</a>
    </section>
    <section class="card generatorPanel">
      <div>
        <h2 style="margin:0 0 6px;">Generator Catalog</h2>
        <div class="subhead">
          Create new generator names so they appear in the image generator dropdown.
        </div>
      </div>
      <form class="generatorForm" id="generatorForm">
        <input
          class="input"
          id="generatorInput"
          type="text"
          placeholder="Add generator name (comma-separated works)"
          autocomplete="off"
        />
        <button class="btn primary" type="submit">Add generator</button>
      </form>
      <div class="generatorList" id="generatorList"></div>
      <div class="subhead">
        “Unspecified” is always available automatically, so you don’t need to add it here.
      </div>
    </section>
  </main>
  <script>
    const STORAGE_KEY = 'generatorCatalog';
    const form = document.getElementById('generatorForm');
    const input = document.getElementById('generatorInput');
    const list = document.getElementById('generatorList');

    const normalizeNames = (value) => {
      const raw = Array.isArray(value) ? value : String(value || '').split(',');
      const names = raw
        .map(name => String(name || '').trim())
        .filter(Boolean)
        .filter(name => name.toLowerCase() !== 'unspecified');
      const seen = new Set();
      const deduped = [];
      for (const name of names) {
        const key = name.toLowerCase();
        if (!seen.has(key)) {
          seen.add(key);
          deduped.push(name);
        }
      }
      return deduped.sort((a, b) => a.localeCompare(b));
    };

    const loadNames = () => {
      if (typeof localStorage === 'undefined') return [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (parsed && Array.isArray(parsed.names)) {
            return normalizeNames(parsed.names);
          }
        }
      } catch (err) {
        console.warn('Failed to load generator catalog', err);
      }
      return [];
    };

    const saveNames = (names) => {
      if (typeof localStorage === 'undefined') return;
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ names: normalizeNames(names) }));
      } catch (err) {
        console.warn('Failed to save generator catalog', err);
      }
    };

    const render = () => {
      const names = loadNames();
      list.innerHTML = '';
      if (!names.length) {
        const empty = document.createElement('div');
        empty.className = 'emptyState';
        empty.textContent = 'No custom generators yet.';
        list.appendChild(empty);
        return;
      }
      names.forEach(name => {
        const item = document.createElement('div');
        item.className = 'generatorItem';

        const label = document.createElement('span');
        label.className = 'generatorName';
        label.textContent = name;

        const button = document.createElement('button');
        button.className = 'btn sm ghost';
        button.type = 'button';
        button.textContent = 'Remove';
        button.addEventListener('click', () => {
          const next = loadNames().filter(entry => entry !== name);
          saveNames(next);
          render();
        });

        item.appendChild(label);
        item.appendChild(button);
        list.appendChild(item);
      });
    };

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const value = input.value;
      const next = normalizeNames([...loadNames(), value]);
      if (!next.length) {
        alert('Enter at least one generator name.');
        return;
      }
      saveNames(next);
      input.value = '';
      render();
    });

    render();
  </script>
</body>
</html>
